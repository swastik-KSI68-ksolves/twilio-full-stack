{"ast":null,"code":"\"use strict\";\n\nvar __extends = this && this.__extends || function () {\n  var extendStatics = function (d, b) {\n    extendStatics = Object.setPrototypeOf || {\n      __proto__: []\n    } instanceof Array && function (d, b) {\n      d.__proto__ = b;\n    } || function (d, b) {\n      for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p];\n    };\n    return extendStatics(d, b);\n  };\n  return function (d, b) {\n    extendStatics(d, b);\n    function __() {\n      this.constructor = d;\n    }\n    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n  };\n}();\nvar __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n      for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n    }\n    return t;\n  };\n  return __assign.apply(this, arguments);\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __generator = this && this.__generator || function (thisArg, body) {\n  var _ = {\n      label: 0,\n      sent: function () {\n        if (t[0] & 1) throw t[1];\n        return t[1];\n      },\n      trys: [],\n      ops: []\n    },\n    f,\n    y,\n    t,\n    g;\n  return g = {\n    next: verb(0),\n    \"throw\": verb(1),\n    \"return\": verb(2)\n  }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function () {\n    return this;\n  }), g;\n  function verb(n) {\n    return function (v) {\n      return step([n, v]);\n    };\n  }\n  function step(op) {\n    if (f) throw new TypeError(\"Generator is already executing.\");\n    while (_) try {\n      if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n      if (y = 0, t) op = [op[0] & 2, t.value];\n      switch (op[0]) {\n        case 0:\n        case 1:\n          t = op;\n          break;\n        case 4:\n          _.label++;\n          return {\n            value: op[1],\n            done: false\n          };\n        case 5:\n          _.label++;\n          y = op[1];\n          op = [0];\n          continue;\n        case 7:\n          op = _.ops.pop();\n          _.trys.pop();\n          continue;\n        default:\n          if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) {\n            _ = 0;\n            continue;\n          }\n          if (op[0] === 3 && (!t || op[1] > t[0] && op[1] < t[3])) {\n            _.label = op[1];\n            break;\n          }\n          if (op[0] === 6 && _.label < t[1]) {\n            _.label = t[1];\n            t = op;\n            break;\n          }\n          if (t && _.label < t[2]) {\n            _.label = t[2];\n            _.ops.push(op);\n            break;\n          }\n          if (t[2]) _.ops.pop();\n          _.trys.pop();\n          continue;\n      }\n      op = body.call(thisArg, _);\n    } catch (e) {\n      op = [6, e];\n      y = 0;\n    } finally {\n      f = t = 0;\n    }\n    if (op[0] & 5) throw op[1];\n    return {\n      value: op[0] ? op[1] : void 0,\n      done: true\n    };\n  }\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\n/**\n * @packageDocumentation\n * @module Voice\n * @preferred\n * @publicapi\n */\nvar events_1 = require(\"events\");\nvar connection_1 = require(\"../connection\");\nvar device_1 = require(\"../device\");\nvar errors_1 = require(\"../errors\");\nvar stats_1 = require(\"../rtc/stats\");\nvar _a = require('../constants'),\n  COWBELL_AUDIO_URL = _a.COWBELL_AUDIO_URL,\n  ECHO_TEST_DURATION = _a.ECHO_TEST_DURATION;\n/**\n * Runs some tests to identify issues, if any, prohibiting successful calling.\n */\nvar PreflightTest = /** @class */function (_super) {\n  __extends(PreflightTest, _super);\n  /**\n   * Construct a {@link PreflightTest} instance.\n   * @constructor\n   * @param token - A Twilio JWT token string.\n   * @param options\n   */\n  function PreflightTest(token, options) {\n    var _this = _super.call(this) || this;\n    /**\n     * Whether this test has already logged an insights-connection-warning.\n     */\n    _this._hasInsightsErrored = false;\n    /**\n     * Network related timing measurements for this test\n     */\n    _this._networkTiming = {};\n    /**\n     * The options passed to {@link PreflightTest} constructor\n     */\n    _this._options = {\n      codecPreferences: [connection_1.default.Codec.PCMU, connection_1.default.Codec.Opus],\n      debug: false,\n      edge: 'roaming',\n      fakeMicInput: false,\n      signalingTimeoutMs: 10000\n    };\n    /**\n     * Current status of this test\n     */\n    _this._status = PreflightTest.Status.Connecting;\n    Object.assign(_this._options, options);\n    _this._samples = [];\n    _this._warnings = [];\n    _this._startTime = Date.now();\n    _this._initDevice(token, __assign(__assign({}, _this._options), {\n      fileInputStream: _this._options.fakeMicInput ? _this._getStreamFromFile() : undefined\n    }));\n    return _this;\n  }\n  /**\n   * Stops the current test and raises a failed event.\n   */\n  PreflightTest.prototype.stop = function () {\n    var _this = this;\n    var error = {\n      code: 31008,\n      message: 'Call cancelled'\n    };\n    if (this._device) {\n      this._device.once('offline', function () {\n        return _this._onFailed(error);\n      });\n      this._device.destroy();\n    } else {\n      this._onFailed(error);\n    }\n  };\n  /**\n   * Emit a {PreflightTest.Warning}\n   */\n  PreflightTest.prototype._emitWarning = function (name, description, rtcWarning) {\n    var warning = {\n      name: name,\n      description: description\n    };\n    if (rtcWarning) {\n      warning.rtcWarning = rtcWarning;\n    }\n    this._warnings.push(warning);\n    this.emit(PreflightTest.Events.Warning, warning);\n  };\n  /**\n   * Returns call quality base on the RTC Stats\n   */\n  PreflightTest.prototype._getCallQuality = function (mos) {\n    if (mos > 4.2) {\n      return PreflightTest.CallQuality.Excellent;\n    } else if (mos >= 4.1 && mos <= 4.2) {\n      return PreflightTest.CallQuality.Great;\n    } else if (mos >= 3.7 && mos <= 4) {\n      return PreflightTest.CallQuality.Good;\n    } else if (mos >= 3.1 && mos <= 3.6) {\n      return PreflightTest.CallQuality.Fair;\n    } else {\n      return PreflightTest.CallQuality.Degraded;\n    }\n  };\n  /**\n   * Returns the report for this test.\n   */\n  PreflightTest.prototype._getReport = function () {\n    var stats = this._getRTCStats();\n    var testTiming = {\n      start: this._startTime\n    };\n    if (this._endTime) {\n      testTiming.end = this._endTime;\n      testTiming.duration = this._endTime - this._startTime;\n    }\n    var report = {\n      callSid: this._callSid,\n      edge: this._edge,\n      iceCandidateStats: this._rtcIceCandidateStatsReport.iceCandidateStats,\n      networkTiming: this._networkTiming,\n      samples: this._samples,\n      selectedEdge: this._options.edge,\n      stats: stats,\n      testTiming: testTiming,\n      totals: this._getRTCSampleTotals(),\n      warnings: this._warnings\n    };\n    var selectedIceCandidatePairStats = this._rtcIceCandidateStatsReport.selectedIceCandidatePairStats;\n    if (selectedIceCandidatePairStats) {\n      report.selectedIceCandidatePairStats = selectedIceCandidatePairStats;\n      report.isTurnRequired = selectedIceCandidatePairStats.localCandidate.candidateType === 'relay' || selectedIceCandidatePairStats.remoteCandidate.candidateType === 'relay';\n    }\n    if (stats) {\n      report.callQuality = this._getCallQuality(stats.mos.average);\n    }\n    return report;\n  };\n  /**\n   * Returns RTC stats totals for this test\n   */\n  PreflightTest.prototype._getRTCSampleTotals = function () {\n    if (!this._latestSample) {\n      return;\n    }\n    return __assign({}, this._latestSample.totals);\n  };\n  /**\n   * Returns RTC related stats captured during the test call\n   */\n  PreflightTest.prototype._getRTCStats = function () {\n    var firstMosSampleIdx = this._samples.findIndex(function (sample) {\n      return typeof sample.mos === 'number' && sample.mos > 0;\n    });\n    var samples = firstMosSampleIdx >= 0 ? this._samples.slice(firstMosSampleIdx) : [];\n    if (!samples || !samples.length) {\n      return;\n    }\n    return ['jitter', 'mos', 'rtt'].reduce(function (statObj, stat) {\n      var _a;\n      var values = samples.map(function (s) {\n        return s[stat];\n      });\n      return __assign(__assign({}, statObj), (_a = {}, _a[stat] = {\n        average: Number((values.reduce(function (total, value) {\n          return total + value;\n        }) / values.length).toPrecision(5)),\n        max: Math.max.apply(Math, values),\n        min: Math.min.apply(Math, values)\n      }, _a));\n    }, {});\n  };\n  /**\n   * Returns a MediaStream from a media file\n   */\n  PreflightTest.prototype._getStreamFromFile = function () {\n    var audioContext = this._options.audioContext;\n    if (!audioContext) {\n      throw new errors_1.NotSupportedError('Cannot fake input audio stream: AudioContext is not supported by this browser.');\n    }\n    var audioEl = new Audio(COWBELL_AUDIO_URL);\n    audioEl.addEventListener('canplaythrough', function () {\n      return audioEl.play();\n    });\n    if (typeof audioEl.setAttribute === 'function') {\n      audioEl.setAttribute('crossorigin', 'anonymous');\n    }\n    var src = audioContext.createMediaElementSource(audioEl);\n    var dest = audioContext.createMediaStreamDestination();\n    src.connect(dest);\n    return dest.stream;\n  };\n  /**\n   * Initialize the device\n   */\n  PreflightTest.prototype._initDevice = function (token, options) {\n    var _this = this;\n    try {\n      this._device = new (options.deviceFactory || device_1.default)(token, {\n        codecPreferences: options.codecPreferences,\n        debug: options.debug,\n        edge: options.edge,\n        fileInputStream: options.fileInputStream,\n        iceServers: options.iceServers,\n        preflight: true,\n        rtcConfiguration: options.rtcConfiguration\n      });\n    } catch (error) {\n      // We want to return before failing so the consumer can capture the event\n      setTimeout(function () {\n        _this._onFailed(error);\n      });\n      return;\n    }\n    this._device.once('ready', function () {\n      _this._onDeviceReady();\n    });\n    this._device.once('error', function (error) {\n      _this._onDeviceError(error);\n    });\n    this._signalingTimeoutTimer = setTimeout(function () {\n      _this._onDeviceError({\n        code: 31901,\n        message: 'WebSocket - Connection Timeout'\n      });\n    }, options.signalingTimeoutMs);\n  };\n  /**\n   * Called on {@link Device} error event\n   * @param error\n   */\n  PreflightTest.prototype._onDeviceError = function (error) {\n    this._device.destroy();\n    this._onFailed(error);\n  };\n  /**\n   * Called on {@link Device} ready event\n   */\n  PreflightTest.prototype._onDeviceReady = function () {\n    var _this = this;\n    clearTimeout(this._echoTimer);\n    clearTimeout(this._signalingTimeoutTimer);\n    this._connection = this._device.connect();\n    this._networkTiming.signaling = {\n      start: Date.now()\n    };\n    this._setupConnectionHandlers(this._connection);\n    this._edge = this._device.edge || undefined;\n    if (this._options.fakeMicInput) {\n      this._echoTimer = setTimeout(function () {\n        return _this._device.disconnectAll();\n      }, ECHO_TEST_DURATION);\n      var audio = this._device.audio;\n      if (audio) {\n        audio.disconnect(false);\n        audio.outgoing(false);\n      }\n    }\n    this._device.once('disconnect', function () {\n      _this._device.once('offline', function () {\n        return _this._onOffline();\n      });\n      _this._device.destroy();\n    });\n    var publisher = this._connection['_publisher'];\n    publisher.on('error', function () {\n      if (!_this._hasInsightsErrored) {\n        _this._emitWarning('insights-connection-error', 'Received an error when attempting to connect to Insights gateway');\n      }\n      _this._hasInsightsErrored = true;\n    });\n  };\n  /**\n   * Called when there is a fatal error\n   * @param error\n   */\n  PreflightTest.prototype._onFailed = function (error) {\n    clearTimeout(this._echoTimer);\n    clearTimeout(this._signalingTimeoutTimer);\n    this._releaseHandlers();\n    this._endTime = Date.now();\n    this._status = PreflightTest.Status.Failed;\n    this.emit(PreflightTest.Events.Failed, error);\n  };\n  /**\n   * Called when the device goes offline.\n   * This indicates that the test has been completed, but we won't know if it failed or not.\n   * The onError event will be the indicator whether the test failed.\n   */\n  PreflightTest.prototype._onOffline = function () {\n    var _this = this;\n    // We need to make sure we always execute preflight.on('completed') last\n    // as client SDK sometimes emits 'offline' event before emitting fatal errors.\n    setTimeout(function () {\n      if (_this._status === PreflightTest.Status.Failed) {\n        return;\n      }\n      clearTimeout(_this._echoTimer);\n      clearTimeout(_this._signalingTimeoutTimer);\n      _this._releaseHandlers();\n      _this._endTime = Date.now();\n      _this._status = PreflightTest.Status.Completed;\n      _this._report = _this._getReport();\n      _this.emit(PreflightTest.Events.Completed, _this._report);\n    }, 10);\n  };\n  /**\n   * Clean up all handlers for device and connection\n   */\n  PreflightTest.prototype._releaseHandlers = function () {\n    [this._device, this._connection].forEach(function (emitter) {\n      if (emitter) {\n        emitter.eventNames().forEach(function (name) {\n          return emitter.removeAllListeners(name);\n        });\n      }\n    });\n  };\n  /**\n   * Setup the event handlers for the {@link Connection} of the test call\n   * @param connection\n   */\n  PreflightTest.prototype._setupConnectionHandlers = function (connection) {\n    var _this = this;\n    if (this._options.fakeMicInput) {\n      // When volume events start emitting, it means all audio outputs have been created.\n      // Let's mute them if we're using fake mic input.\n      connection.once('volume', function () {\n        connection.mediaStream.outputs.forEach(function (output) {\n          return output.audio.muted = true;\n        });\n      });\n    }\n    connection.on('warning', function (name, data) {\n      _this._emitWarning(name, 'Received an RTCWarning. See .rtcWarning for the RTCWarning', data);\n    });\n    connection.once('accept', function () {\n      _this._callSid = connection.mediaStream.callSid;\n      _this._status = PreflightTest.Status.Connected;\n      _this.emit(PreflightTest.Events.Connected);\n    });\n    connection.on('sample', function (sample) {\n      return __awaiter(_this, void 0, void 0, function () {\n        var _a;\n        return __generator(this, function (_b) {\n          switch (_b.label) {\n            case 0:\n              if (!!this._latestSample) return [3 /*break*/, 2];\n              _a = this;\n              return [4 /*yield*/, (this._options.getRTCIceCandidateStatsReport || stats_1.getRTCIceCandidateStatsReport)(connection.mediaStream.version.pc)];\n            case 1:\n              _a._rtcIceCandidateStatsReport = _b.sent();\n              _b.label = 2;\n            case 2:\n              this._latestSample = sample;\n              this._samples.push(sample);\n              this.emit(PreflightTest.Events.Sample, sample);\n              return [2 /*return*/];\n          }\n        });\n      });\n    });\n    // TODO: Update the following once the SDK supports emitting these events\n    // Let's shim for now\n    [{\n      reportLabel: 'peerConnection',\n      type: 'pcconnection'\n    }, {\n      reportLabel: 'ice',\n      type: 'iceconnection'\n    }, {\n      reportLabel: 'dtls',\n      type: 'dtlstransport'\n    }, {\n      reportLabel: 'signaling',\n      type: 'signaling'\n    }].forEach(function (_a) {\n      var type = _a.type,\n        reportLabel = _a.reportLabel;\n      var handlerName = \"on\" + type + \"statechange\";\n      var originalHandler = connection.mediaStream[handlerName];\n      connection.mediaStream[handlerName] = function (state) {\n        var timing = _this._networkTiming[reportLabel] = _this._networkTiming[reportLabel] || {\n          start: 0\n        };\n        if (state === 'connecting' || state === 'checking') {\n          timing.start = Date.now();\n        } else if ((state === 'connected' || state === 'stable') && !timing.duration) {\n          timing.end = Date.now();\n          timing.duration = timing.end - timing.start;\n        }\n        originalHandler(state);\n      };\n    });\n  };\n  Object.defineProperty(PreflightTest.prototype, \"callSid\", {\n    /**\n     * The callsid generated for the test call.\n     */\n    get: function () {\n      return this._callSid;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(PreflightTest.prototype, \"endTime\", {\n    /**\n     * A timestamp in milliseconds of when the test ended.\n     */\n    get: function () {\n      return this._endTime;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(PreflightTest.prototype, \"latestSample\", {\n    /**\n     * The latest WebRTC sample collected.\n     */\n    get: function () {\n      return this._latestSample;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(PreflightTest.prototype, \"report\", {\n    /**\n     * The report for this test.\n     */\n    get: function () {\n      return this._report;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(PreflightTest.prototype, \"startTime\", {\n    /**\n     * A timestamp in milliseconds of when the test started.\n     */\n    get: function () {\n      return this._startTime;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  Object.defineProperty(PreflightTest.prototype, \"status\", {\n    /**\n     * The status of the test.\n     */\n    get: function () {\n      return this._status;\n    },\n    enumerable: true,\n    configurable: true\n  });\n  return PreflightTest;\n}(events_1.EventEmitter);\nexports.PreflightTest = PreflightTest;\n(function (PreflightTest) {\n  /**\n   * The quality of the call determined by different mos ranges.\n   * Mos is calculated base on the WebRTC stats - rtt, jitter, and packet lost.\n   */\n  var CallQuality;\n  (function (CallQuality) {\n    /**\n     * If the average mos is over 4.2.\n     */\n    CallQuality[\"Excellent\"] = \"excellent\";\n    /**\n     * If the average mos is between 4.1 and 4.2 both inclusive.\n     */\n    CallQuality[\"Great\"] = \"great\";\n    /**\n     * If the average mos is between 3.7 and 4.0 both inclusive.\n     */\n    CallQuality[\"Good\"] = \"good\";\n    /**\n     * If the average mos is between 3.1 and 3.6 both inclusive.\n     */\n    CallQuality[\"Fair\"] = \"fair\";\n    /**\n     * If the average mos is 3.0 or below.\n     */\n    CallQuality[\"Degraded\"] = \"degraded\";\n  })(CallQuality = PreflightTest.CallQuality || (PreflightTest.CallQuality = {}));\n  /**\n   * Possible events that a [[PreflightTest]] might emit.\n   */\n  var Events;\n  (function (Events) {\n    /**\n     * See [[PreflightTest.completedEvent]]\n     */\n    Events[\"Completed\"] = \"completed\";\n    /**\n     * See [[PreflightTest.connectedEvent]]\n     */\n    Events[\"Connected\"] = \"connected\";\n    /**\n     * See [[PreflightTest.failedEvent]]\n     */\n    Events[\"Failed\"] = \"failed\";\n    /**\n     * See [[PreflightTest.sampleEvent]]\n     */\n    Events[\"Sample\"] = \"sample\";\n    /**\n     * See [[PreflightTest.warningEvent]]\n     */\n    Events[\"Warning\"] = \"warning\";\n  })(Events = PreflightTest.Events || (PreflightTest.Events = {}));\n  /**\n   * Possible status of the test.\n   */\n  var Status;\n  (function (Status) {\n    /**\n     * Connection to Twilio has initiated.\n     */\n    Status[\"Connecting\"] = \"connecting\";\n    /**\n     * Connection to Twilio has been established.\n     */\n    Status[\"Connected\"] = \"connected\";\n    /**\n     * The connection to Twilio has been disconnected and the test call has completed.\n     */\n    Status[\"Completed\"] = \"completed\";\n    /**\n     * The test has stopped and failed.\n     */\n    Status[\"Failed\"] = \"failed\";\n  })(Status = PreflightTest.Status || (PreflightTest.Status = {}));\n})(PreflightTest = exports.PreflightTest || (exports.PreflightTest = {}));\nexports.PreflightTest = PreflightTest;","map":{"version":3,"names":["events_1","require","connection_1","device_1","errors_1","stats_1","_a","COWBELL_AUDIO_URL","ECHO_TEST_DURATION","PreflightTest","_super","__extends","token","options","_this","call","_hasInsightsErrored","_networkTiming","_options","codecPreferences","default","Codec","PCMU","Opus","debug","edge","fakeMicInput","signalingTimeoutMs","_status","Status","Connecting","Object","assign","_samples","_warnings","_startTime","Date","now","_initDevice","__assign","fileInputStream","_getStreamFromFile","undefined","prototype","stop","error","code","message","_device","once","_onFailed","destroy","_emitWarning","name","description","rtcWarning","warning","push","emit","Events","Warning","_getCallQuality","mos","CallQuality","Excellent","Great","Good","Fair","Degraded","_getReport","stats","_getRTCStats","testTiming","start","_endTime","end","duration","report","callSid","_callSid","_edge","iceCandidateStats","_rtcIceCandidateStatsReport","networkTiming","samples","selectedEdge","totals","_getRTCSampleTotals","warnings","selectedIceCandidatePairStats","isTurnRequired","localCandidate","candidateType","remoteCandidate","callQuality","average","_latestSample","firstMosSampleIdx","findIndex","sample","slice","length","reduce","statObj","stat","values","map","s","Number","total","value","toPrecision","max","Math","apply","min","audioContext","NotSupportedError","audioEl","Audio","addEventListener","play","setAttribute","src","createMediaElementSource","dest","createMediaStreamDestination","connect","stream","deviceFactory","iceServers","preflight","rtcConfiguration","setTimeout","_onDeviceReady","_onDeviceError","_signalingTimeoutTimer","clearTimeout","_echoTimer","_connection","signaling","_setupConnectionHandlers","disconnectAll","audio","disconnect","outgoing","_onOffline","publisher","on","_releaseHandlers","Failed","Completed","_report","forEach","emitter","eventNames","removeAllListeners","connection","mediaStream","outputs","output","muted","data","Connected","__awaiter","getRTCIceCandidateStatsReport","version","pc","_b","sent","Sample","reportLabel","type","handlerName","originalHandler","state","timing","defineProperty","get","EventEmitter","exports"],"sources":["/home/swastikksi/Documents/react/twilio-Ksolves/node_modules/twilio-client/lib/twilio/preflight/preflight.ts"],"sourcesContent":["/**\n * @packageDocumentation\n * @module Voice\n * @preferred\n * @publicapi\n */\nimport { EventEmitter } from 'events';\nimport Connection from '../connection';\nimport Device from '../device';\nimport { NotSupportedError } from '../errors';\nimport { RTCSampleTotals } from '../rtc/sample';\nimport RTCSample from '../rtc/sample';\nimport { getRTCIceCandidateStatsReport } from '../rtc/stats';\nimport RTCWarning from '../rtc/warning';\nimport StatsMonitor from '../statsMonitor';\nimport { NetworkTiming, TimeMeasurement } from './timing';\n\nconst { COWBELL_AUDIO_URL, ECHO_TEST_DURATION } = require('../constants');\n\n/**\n * Placeholder until we convert peerconnection.js to TypeScript.\n * Represents the audio output object coming from Client SDK's PeerConnection object.\n * @internalapi\n */\nexport interface AudioOutput {\n  /**\n   * The audio element used to play out the sound.\n   */\n  audio: HTMLAudioElement;\n}\n\nexport declare interface PreflightTest {\n  /**\n   * Raised when [[PreflightTest.status]] has transitioned to [[PreflightTest.Status.Completed]].\n   * During this time, [[PreflightTest.report]] is available and ready to be inspected.\n   * In some cases, this will not trigger if the test encounters a fatal error prior connecting to Twilio.\n   * See [[PreflightTest.failedEvent]].\n   * @param report\n   * @example `preflight.on('completed', report => console.log(report))`\n   * @event\n   */\n  completedEvent(report: PreflightTest.Report): void;\n\n  /**\n   * Raised when [[PreflightTest.status]] has transitioned to [[PreflightTest.Status.Connected]].\n   * @example `preflight.on('connected', () => console.log('Test connected'))`\n   * @event\n   */\n  connectedEvent(): void;\n\n  /**\n   * Raised when [[PreflightTest.status]] has transitioned to [[PreflightTest.Status.Failed]].\n   * This happens when establishing a connection to Twilio has failed or when a test call has encountered a fatal error.\n   * This is also raised if [[PreflightTest.stop]] is called while the test is in progress.\n   * @param error\n   * @example `preflight.on('failed', error => console.log(error))`\n   * @event\n   */\n  failedEvent(error: Device.Error | DOMError): void;\n\n  /**\n   * Raised when the [[Connection]] gets a webrtc sample object. This event is published every second.\n   * @param sample\n   * @example `preflight.on('sample', sample => console.log(sample))`\n   * @event\n   */\n  sampleEvent(sample: RTCSample): void;\n\n  /**\n   * Raised whenever the [[Connection]] encounters a warning.\n   * @param name - The name of the warning.\n   * @example `preflight.on('warning', (name, data) => console.log({ name, data }))`\n   * @event\n   */\n  warningEvent(name: string, data: PreflightTest.Warning): void;\n}\n\n/**\n * Runs some tests to identify issues, if any, prohibiting successful calling.\n */\nexport class PreflightTest extends EventEmitter {\n  /**\n   * Callsid generated for this test call\n   */\n  private _callSid: string | undefined;\n\n  /**\n   * The {@link Connection} for this test call\n   */\n  private _connection: Connection;\n\n  /**\n   * The {@link Device} for this test call\n   */\n  private _device: Device;\n\n  /**\n   * The timer when doing an echo test\n   * The echo test is used when fakeMicInput is set to true\n   */\n  private _echoTimer: NodeJS.Timer;\n\n  /**\n   * The edge that the `Twilio.Device` connected to.\n   */\n  private _edge: string | undefined;\n\n  /**\n   * End of test timestamp\n   */\n  private _endTime: number | undefined;\n\n  /**\n   * Whether this test has already logged an insights-connection-warning.\n   */\n  private _hasInsightsErrored: boolean = false;\n\n  /**\n   * Latest WebRTC sample collected for this test\n   */\n  private _latestSample: RTCSample | undefined;\n\n  /**\n   * Network related timing measurements for this test\n   */\n  private _networkTiming: NetworkTiming = {};\n\n  /**\n   * The options passed to {@link PreflightTest} constructor\n   */\n  private _options: PreflightTest.ExtendedOptions = {\n    codecPreferences: [Connection.Codec.PCMU, Connection.Codec.Opus],\n    debug: false,\n    edge: 'roaming',\n    fakeMicInput: false,\n    signalingTimeoutMs: 10000,\n  };\n\n  /**\n   * The report for this test.\n   */\n  private _report: PreflightTest.Report | undefined;\n\n  /**\n   * The WebRTC ICE candidates stats information collected during the test\n   */\n  private _rtcIceCandidateStatsReport: PreflightTest.RTCIceCandidateStatsReport;\n\n  /**\n   * WebRTC samples collected during this test\n   */\n  private _samples: RTCSample[];\n\n  /**\n   * Timer for setting up signaling connection\n   */\n  private _signalingTimeoutTimer: number;\n\n  /**\n   * Start of test timestamp\n   */\n  private _startTime: number;\n\n  /**\n   * Current status of this test\n   */\n  private _status: PreflightTest.Status = PreflightTest.Status.Connecting;\n\n  /**\n   * List of warning names and warning data detected during this test\n   */\n  private _warnings: PreflightTest.Warning[];\n\n  /**\n   * Construct a {@link PreflightTest} instance.\n   * @constructor\n   * @param token - A Twilio JWT token string.\n   * @param options\n   */\n  constructor(token: string, options: PreflightTest.ExtendedOptions) {\n    super();\n\n    Object.assign(this._options, options);\n\n    this._samples = [];\n    this._warnings = [];\n    this._startTime = Date.now();\n\n    this._initDevice(token, {\n      ...this._options,\n      fileInputStream: this._options.fakeMicInput ?\n        this._getStreamFromFile() : undefined,\n    });\n  }\n\n  /**\n   * Stops the current test and raises a failed event.\n   */\n  stop(): void {\n    const error: Device.Error = {\n      code: 31008,\n      message: 'Call cancelled',\n    };\n    if (this._device) {\n      this._device.once('offline', () => this._onFailed(error));\n      this._device.destroy();\n    } else {\n      this._onFailed(error);\n    }\n  }\n\n  /**\n   * Emit a {PreflightTest.Warning}\n   */\n  private _emitWarning(name: string, description: string, rtcWarning?: RTCWarning): void {\n    const warning: PreflightTest.Warning = { name, description };\n    if (rtcWarning) {\n      warning.rtcWarning = rtcWarning;\n    }\n    this._warnings.push(warning);\n    this.emit(PreflightTest.Events.Warning, warning);\n  }\n\n  /**\n   * Returns call quality base on the RTC Stats\n   */\n  private _getCallQuality(mos: number): PreflightTest.CallQuality {\n    if (mos > 4.2) {\n      return PreflightTest.CallQuality.Excellent;\n    } else if (mos >= 4.1 && mos <= 4.2) {\n      return PreflightTest.CallQuality.Great;\n    } else if (mos >= 3.7 && mos <= 4) {\n      return PreflightTest.CallQuality.Good;\n    } else if (mos >= 3.1 && mos <= 3.6) {\n      return PreflightTest.CallQuality.Fair;\n    } else {\n      return PreflightTest.CallQuality.Degraded;\n    }\n  }\n\n  /**\n   * Returns the report for this test.\n   */\n  private _getReport(): PreflightTest.Report {\n    const stats = this._getRTCStats();\n    const testTiming: TimeMeasurement = { start: this._startTime };\n    if (this._endTime) {\n      testTiming.end = this._endTime;\n      testTiming.duration  = this._endTime - this._startTime;\n    }\n\n    const report: PreflightTest.Report = {\n      callSid: this._callSid,\n      edge: this._edge,\n      iceCandidateStats: this._rtcIceCandidateStatsReport.iceCandidateStats,\n      networkTiming: this._networkTiming,\n      samples: this._samples,\n      selectedEdge: this._options.edge,\n      stats,\n      testTiming,\n      totals: this._getRTCSampleTotals(),\n      warnings: this._warnings,\n    };\n\n    const selectedIceCandidatePairStats = this._rtcIceCandidateStatsReport.selectedIceCandidatePairStats;\n\n    if (selectedIceCandidatePairStats) {\n      report.selectedIceCandidatePairStats = selectedIceCandidatePairStats;\n      report.isTurnRequired = selectedIceCandidatePairStats.localCandidate.candidateType === 'relay'\n      || selectedIceCandidatePairStats.remoteCandidate.candidateType === 'relay';\n    }\n\n    if (stats) {\n      report.callQuality = this._getCallQuality(stats.mos.average);\n    }\n\n    return report;\n  }\n\n  /**\n   * Returns RTC stats totals for this test\n   */\n  private _getRTCSampleTotals(): RTCSampleTotals | undefined {\n    if (!this._latestSample) {\n      return;\n    }\n\n    return { ...this._latestSample.totals };\n  }\n\n  /**\n   * Returns RTC related stats captured during the test call\n   */\n  private _getRTCStats(): PreflightTest.RTCStats | undefined {\n    const firstMosSampleIdx = this._samples.findIndex(\n      sample => typeof sample.mos === 'number' && sample.mos > 0,\n    );\n\n    const samples = firstMosSampleIdx >= 0\n      ? this._samples.slice(firstMosSampleIdx)\n      : [];\n\n    if (!samples || !samples.length) {\n      return;\n    }\n\n    return ['jitter', 'mos', 'rtt'].reduce((statObj, stat) => {\n      const values = samples.map(s => s[stat]);\n      return {\n        ...statObj,\n        [stat]: {\n          average: Number((values.reduce((total, value) => total + value) / values.length).toPrecision(5)),\n          max: Math.max(...values),\n          min: Math.min(...values),\n        },\n      };\n    }, {} as any);\n  }\n\n  /**\n   * Returns a MediaStream from a media file\n   */\n  private _getStreamFromFile(): MediaStream {\n    const audioContext = this._options.audioContext;\n    if (!audioContext) {\n      throw new NotSupportedError('Cannot fake input audio stream: AudioContext is not supported by this browser.');\n    }\n\n    const audioEl: any = new Audio(COWBELL_AUDIO_URL);\n\n    audioEl.addEventListener('canplaythrough', () => audioEl.play());\n    if (typeof audioEl.setAttribute === 'function') {\n      audioEl.setAttribute('crossorigin', 'anonymous');\n    }\n\n    const src = audioContext.createMediaElementSource(audioEl);\n    const dest = audioContext.createMediaStreamDestination();\n    src.connect(dest);\n\n    return dest.stream;\n  }\n\n  /**\n   * Initialize the device\n   */\n  private _initDevice(token: string, options: PreflightTest.ExtendedOptions): void {\n    try {\n      this._device = new (options.deviceFactory || Device)(token, {\n        codecPreferences: options.codecPreferences,\n        debug: options.debug,\n        edge: options.edge,\n        fileInputStream: options.fileInputStream,\n        iceServers: options.iceServers,\n        preflight: true,\n        rtcConfiguration: options.rtcConfiguration,\n      });\n    } catch (error) {\n      // We want to return before failing so the consumer can capture the event\n      setTimeout(() => {\n        this._onFailed(error);\n      });\n      return;\n    }\n\n    this._device.once('ready', () => {\n      this._onDeviceReady();\n    });\n\n    this._device.once('error', (error: Device.Error) => {\n      this._onDeviceError(error);\n    });\n\n    this._signalingTimeoutTimer = setTimeout(() => {\n      this._onDeviceError({\n        code: 31901,\n        message: 'WebSocket - Connection Timeout',\n      });\n    }, options.signalingTimeoutMs);\n  }\n\n  /**\n   * Called on {@link Device} error event\n   * @param error\n   */\n  private _onDeviceError(error: Device.Error): void {\n    this._device.destroy();\n    this._onFailed(error);\n  }\n\n  /**\n   * Called on {@link Device} ready event\n   */\n  private _onDeviceReady(): void {\n    clearTimeout(this._echoTimer);\n    clearTimeout(this._signalingTimeoutTimer);\n\n    this._connection = this._device.connect();\n    this._networkTiming.signaling = { start: Date.now() };\n    this._setupConnectionHandlers(this._connection);\n\n    this._edge = this._device.edge || undefined;\n    if (this._options.fakeMicInput) {\n      this._echoTimer = setTimeout(() => this._device.disconnectAll(), ECHO_TEST_DURATION);\n\n      const audio = this._device.audio as any;\n      if (audio) {\n        audio.disconnect(false);\n        audio.outgoing(false);\n      }\n    }\n\n    this._device.once('disconnect', () => {\n      this._device.once('offline', () => this._onOffline());\n      this._device.destroy();\n    });\n\n    const publisher = this._connection['_publisher'] as any;\n    publisher.on('error', () => {\n      if (!this._hasInsightsErrored) {\n        this._emitWarning('insights-connection-error',\n          'Received an error when attempting to connect to Insights gateway');\n      }\n      this._hasInsightsErrored = true;\n    });\n  }\n\n  /**\n   * Called when there is a fatal error\n   * @param error\n   */\n  private _onFailed(error: Device.Error | DOMError): void {\n    clearTimeout(this._echoTimer);\n    clearTimeout(this._signalingTimeoutTimer);\n    this._releaseHandlers();\n    this._endTime = Date.now();\n    this._status = PreflightTest.Status.Failed;\n    this.emit(PreflightTest.Events.Failed, error);\n  }\n\n  /**\n   * Called when the device goes offline.\n   * This indicates that the test has been completed, but we won't know if it failed or not.\n   * The onError event will be the indicator whether the test failed.\n   */\n  private _onOffline(): void {\n    // We need to make sure we always execute preflight.on('completed') last\n    // as client SDK sometimes emits 'offline' event before emitting fatal errors.\n    setTimeout(() => {\n      if (this._status === PreflightTest.Status.Failed) {\n        return;\n      }\n\n      clearTimeout(this._echoTimer);\n      clearTimeout(this._signalingTimeoutTimer);\n\n      this._releaseHandlers();\n      this._endTime = Date.now();\n      this._status = PreflightTest.Status.Completed;\n      this._report = this._getReport();\n      this.emit(PreflightTest.Events.Completed, this._report);\n    }, 10);\n  }\n\n  /**\n   * Clean up all handlers for device and connection\n   */\n  private _releaseHandlers(): void {\n    [this._device, this._connection].forEach((emitter: EventEmitter) => {\n      if (emitter) {\n        emitter.eventNames().forEach((name: string) => emitter.removeAllListeners(name));\n      }\n    });\n  }\n\n  /**\n   * Setup the event handlers for the {@link Connection} of the test call\n   * @param connection\n   */\n  private _setupConnectionHandlers(connection: Connection): void {\n    if (this._options.fakeMicInput) {\n      // When volume events start emitting, it means all audio outputs have been created.\n      // Let's mute them if we're using fake mic input.\n      connection.once('volume', () => {\n        connection.mediaStream.outputs\n          .forEach((output: AudioOutput) => output.audio.muted = true);\n      });\n    }\n\n    connection.on('warning', (name: string, data: RTCWarning) => {\n      this._emitWarning(name, 'Received an RTCWarning. See .rtcWarning for the RTCWarning', data);\n    });\n\n    connection.once('accept', () => {\n      this._callSid = connection.mediaStream.callSid;\n      this._status = PreflightTest.Status.Connected;\n      this.emit(PreflightTest.Events.Connected);\n    });\n\n    connection.on('sample', async (sample) => {\n      // RTC Stats are ready. We only need to get ICE candidate stats report once.\n      if (!this._latestSample) {\n        this._rtcIceCandidateStatsReport = await (\n          this._options.getRTCIceCandidateStatsReport || getRTCIceCandidateStatsReport\n        )(connection.mediaStream.version.pc);\n      }\n\n      this._latestSample = sample;\n      this._samples.push(sample);\n      this.emit(PreflightTest.Events.Sample, sample);\n    });\n\n    // TODO: Update the following once the SDK supports emitting these events\n    // Let's shim for now\n    [{\n      reportLabel: 'peerConnection',\n      type: 'pcconnection',\n     }, {\n      reportLabel: 'ice',\n      type: 'iceconnection',\n     }, {\n      reportLabel: 'dtls',\n      type: 'dtlstransport',\n     }, {\n      reportLabel: 'signaling',\n      type: 'signaling',\n     }].forEach(({type, reportLabel}) => {\n\n      const handlerName = `on${type}statechange`;\n      const originalHandler = connection.mediaStream[handlerName];\n\n      connection.mediaStream[handlerName] = (state: string) => {\n        const timing = (this._networkTiming as any)[reportLabel]\n          = (this._networkTiming as any)[reportLabel] || { start: 0 };\n\n        if (state === 'connecting' || state === 'checking') {\n          timing.start = Date.now();\n        } else if ((state === 'connected' || state === 'stable') && !timing.duration) {\n          timing.end = Date.now();\n          timing.duration = timing.end - timing.start;\n        }\n\n        originalHandler(state);\n      };\n    });\n  }\n\n  /**\n   * The callsid generated for the test call.\n   */\n  get callSid(): string | undefined {\n    return this._callSid;\n  }\n\n  /**\n   * A timestamp in milliseconds of when the test ended.\n   */\n  get endTime(): number | undefined {\n    return this._endTime;\n  }\n\n  /**\n   * The latest WebRTC sample collected.\n   */\n  get latestSample(): RTCSample | undefined {\n    return this._latestSample;\n  }\n\n  /**\n   * The report for this test.\n   */\n  get report(): PreflightTest.Report | undefined {\n    return this._report;\n  }\n\n  /**\n   * A timestamp in milliseconds of when the test started.\n   */\n  get startTime(): number {\n    return this._startTime;\n  }\n\n  /**\n   * The status of the test.\n   */\n  get status(): PreflightTest.Status {\n    return this._status;\n  }\n}\n\nexport namespace PreflightTest {\n  /**\n   * The quality of the call determined by different mos ranges.\n   * Mos is calculated base on the WebRTC stats - rtt, jitter, and packet lost.\n   */\n  export enum CallQuality {\n    /**\n     * If the average mos is over 4.2.\n     */\n    Excellent = 'excellent',\n\n    /**\n     * If the average mos is between 4.1 and 4.2 both inclusive.\n     */\n    Great = 'great',\n\n    /**\n     * If the average mos is between 3.7 and 4.0 both inclusive.\n     */\n    Good = 'good',\n\n    /**\n     * If the average mos is between 3.1 and 3.6 both inclusive.\n     */\n    Fair = 'fair',\n\n    /**\n     * If the average mos is 3.0 or below.\n     */\n    Degraded = 'degraded',\n  }\n\n  /**\n   * Possible events that a [[PreflightTest]] might emit.\n   */\n  export enum Events {\n    /**\n     * See [[PreflightTest.completedEvent]]\n     */\n    Completed = 'completed',\n\n    /**\n     * See [[PreflightTest.connectedEvent]]\n     */\n    Connected = 'connected',\n\n    /**\n     * See [[PreflightTest.failedEvent]]\n     */\n    Failed = 'failed',\n\n    /**\n     * See [[PreflightTest.sampleEvent]]\n     */\n    Sample = 'sample',\n\n    /**\n     * See [[PreflightTest.warningEvent]]\n     */\n    Warning = 'warning',\n  }\n\n  /**\n   * Possible status of the test.\n   */\n  export enum Status {\n    /**\n     * Connection to Twilio has initiated.\n     */\n    Connecting = 'connecting',\n\n    /**\n     * Connection to Twilio has been established.\n     */\n    Connected = 'connected',\n\n    /**\n     * The connection to Twilio has been disconnected and the test call has completed.\n     */\n    Completed = 'completed',\n\n    /**\n     * The test has stopped and failed.\n     */\n    Failed = 'failed',\n  }\n\n  /**\n   * The WebRTC API's [RTCIceCandidateStats](https://developer.mozilla.org/en-US/docs/Web/API/RTCIceCandidateStats)\n   * dictionary which provides information related to an ICE candidate.\n   */\n  export type RTCIceCandidateStats = any;\n\n  /**\n   * Options that may be passed to {@link PreflightTest} constructor for internal testing.\n   * @internalapi\n   */\n  export interface ExtendedOptions extends Options {\n    /**\n     * The AudioContext instance to use\n     */\n    audioContext?: AudioContext;\n\n    /**\n     * Device class to use.\n     */\n    deviceFactory?: new (token: string, options: Device.Options) => Device;\n\n    /**\n     * File input stream to use instead of reading from mic\n     */\n    fileInputStream?: MediaStream;\n\n    /**\n     * The getRTCIceCandidateStatsReport to use for testing.\n     */\n    getRTCIceCandidateStatsReport?: Function;\n\n    /**\n     * An RTCConfiguration to pass to the RTCPeerConnection constructor during `Device.setup`.\n     */\n    rtcConfiguration?: RTCConfiguration;\n  }\n\n  /**\n   * A WebRTC stats report containing relevant information about selected and gathered ICE candidates\n   */\n  export interface RTCIceCandidateStatsReport {\n    /**\n     * An array of WebRTC stats for the ICE candidates gathered when connecting to media.\n     */\n    iceCandidateStats: RTCIceCandidateStats[];\n\n    /**\n     * A WebRTC stats for the ICE candidate pair used to connect to media, if candidates were selected.\n     */\n    selectedIceCandidatePairStats?: RTCSelectedIceCandidatePairStats;\n  }\n\n  /**\n   * Options passed to {@link PreflightTest} constructor.\n   */\n  export interface Options {\n    /**\n     * An ordered array of codec names that will be used during the test call,\n     * from most to least preferred.\n     * @default ['pcmu','opus']\n     */\n    codecPreferences?: Connection.Codec[];\n\n    /**\n     * Whether to enable debug logging.\n     * @default false\n     */\n    debug?: boolean;\n\n    /**\n     * Specifies which Twilio Data Center to use when initiating the test call.\n     * Please see this\n     * [page](https://www.twilio.com/docs/voice/client/edges)\n     * for the list of available edges.\n     * @default roaming\n     */\n    edge?: string;\n\n    /**\n     * If set to `true`, the test call will ignore microphone input and will use a default audio file.\n     * If set to `false`, the test call will capture the audio from the microphone.\n     * Setting this to `true` is only supported on Chrome and will throw a fatal error on other browsers\n     * @default false\n     */\n    fakeMicInput?: boolean;\n\n    /**\n     * An array of custom ICE servers to use to connect media. If you provide both STUN and TURN server configurations,\n     * the test will detect whether a TURN server is required to establish a connection.\n     *\n     * The following example demonstrates how to use [Twilio's Network Traversal Service](https://www.twilio.com/stun-turn)\n     * to generate STUN/TURN credentials and how to specify a specific [edge location](https://www.twilio.com/docs/global-infrastructure/edge-locations).\n     *\n     * ```ts\n     * import Client from 'twilio';\n     * import { Device } from 'twilio-client';\n     *\n     * // Generate the STUN and TURN server credentials with a ttl of 120 seconds\n     * const client = Client(twilioAccountSid, authToken);\n     * const token = await client.tokens.create({ ttl: 120 });\n     *\n     * let iceServers = token.iceServers;\n     *\n     * // By default, global will be used as the default edge location.\n     * // You can replace global with a specific edge name for each of the iceServer configuration.\n     * iceServers = iceServers.map(config => {\n     *   let { url, urls, ...rest } = config;\n     *   url = url.replace('global', 'ashburn');\n     *   urls = urls.replace('global', 'ashburn');\n     *\n     *   return { url, urls, ...rest };\n     * });\n     *\n     * // Use the TURN credentials using the iceServers parameter\n     * const preflightTest = Device.runPreflight(token, { iceServers });\n     *\n     * // Read from the report object to determine whether TURN is required to connect to media\n     * preflightTest.on('completed', (report) => {\n     *   console.log(report.isTurnRequired);\n     * });\n     * ```\n     *\n     * @default null\n     */\n    iceServers?: RTCIceServer[];\n\n    /**\n     * Amount of time to wait for setting up signaling connection.\n     * @default 10000\n     */\n    signalingTimeoutMs?: number;\n  }\n\n  /**\n   * Represents the WebRTC stats for the ICE candidate pair used to connect to media, if candidates were selected.\n   */\n  export interface RTCSelectedIceCandidatePairStats {\n    /**\n     * An [RTCIceCandidateStats](https://developer.mozilla.org/en-US/docs/Web/API/RTCIceCandidateStats)\n     * object which provides information related to the selected local ICE candidate.\n     */\n    localCandidate: RTCIceCandidateStats;\n\n    /**\n     * An [RTCIceCandidateStats](https://developer.mozilla.org/en-US/docs/Web/API/RTCIceCandidateStats)\n     * object which provides information related to the selected remote ICE candidate.\n     */\n    remoteCandidate: RTCIceCandidateStats;\n  }\n\n  /**\n   * Represents RTC related stats that are extracted from RTC samples.\n   */\n  export interface RTCStats {\n    /**\n     * Packets delay variation.\n     */\n    jitter: Stats;\n\n    /**\n     * Mean opinion score, 1.0 through roughly 4.5.\n     */\n    mos: Stats;\n\n    /**\n     * Round trip time, to the server back to the client.\n     */\n    rtt: Stats;\n  }\n\n  /**\n   * Represents general stats for a specific metric.\n   */\n  export interface Stats {\n    /**\n     * The average value for this metric.\n     */\n    average: number;\n\n    /**\n     * The maximum value for this metric.\n     */\n    max: number;\n\n    /**\n     * The minimum value for this metric.\n     */\n    min: number;\n  }\n\n  /**\n   * Represents the report generated from a {@link PreflightTest}.\n   */\n  export interface Report {\n    /**\n     * The quality of the call determined by different mos ranges.\n     */\n    callQuality?: CallQuality;\n\n    /**\n     * CallSid generaged during the test.\n     */\n    callSid: string | undefined;\n\n    /**\n     * The edge that the test call was connected to.\n     */\n    edge?: string;\n\n    /**\n     * An array of WebRTC stats for the ICE candidates gathered when connecting to media.\n     */\n    iceCandidateStats: RTCIceCandidateStats[];\n\n    /**\n     * Whether a TURN server is required to connect to media.\n     * This is dependent on the selected ICE candidates, and will be true if either is of type \"relay\",\n     * false if both are of another type, or undefined if there are no selected ICE candidates.\n     * See `PreflightTest.Options.iceServers` for more details.\n     */\n    isTurnRequired?: boolean;\n\n    /**\n     * Network related time measurements.\n     */\n    networkTiming: NetworkTiming;\n\n    /**\n     * WebRTC samples collected during the test.\n     */\n    samples: RTCSample[];\n\n    /**\n     * The edge passed to `Device.runPreflight`.\n     */\n    selectedEdge?: string;\n\n    /**\n     * A WebRTC stats for the ICE candidate pair used to connect to media, if candidates were selected.\n     */\n    selectedIceCandidatePairStats?: RTCSelectedIceCandidatePairStats;\n\n    /**\n     * RTC related stats captured during the test.\n     */\n    stats?: RTCStats;\n\n    /**\n     * Time measurements of test run time.\n     */\n    testTiming: TimeMeasurement;\n\n    /**\n     * Calculated totals in RTC statistics samples.\n     */\n    totals?: RTCSampleTotals;\n\n    /**\n     * List of warning names and warning data detected during this test.\n     */\n    warnings: PreflightTest.Warning[];\n  }\n\n  /**\n   * A warning that can be raised by Preflight, and returned in the Report.warnings field.\n   */\n  export interface Warning {\n    /**\n     * Description of the Warning\n     */\n    description: string;\n    /**\n     * Name of the Warning\n     */\n    name: string;\n    /**\n     * If applicable, the RTCWarning that triggered this warning.\n     */\n    rtcWarning?: RTCWarning;\n  }\n }\n"],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}